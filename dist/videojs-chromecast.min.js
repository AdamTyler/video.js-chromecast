/**
 * videojs-chromeCast
 * @version 1.0.0
 * @copyright 2016 Benjipott, Inc.
 * @license Apache-2.0
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsChromecast=e()}}(function(){return function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[s]={exports:{}};t[s][0].call(l.exports,function(e){var i=t[s][1][e];return o(i?i:e)},l,l.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,i){(function(e){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(e,t,i){for(var n=!0;n;){var o=e,r=t,s=i;n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,r);if(void 0!==a){if("value"in a)return a.value;var c=a.get;if(void 0===c)return;return c.call(s)}var u=Object.getPrototypeOf(o);if(null===u)return;e=u,t=r,i=s,n=!0,a=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,u=n(c),l=u["default"].getComponent("Component"),d=u["default"].getComponent("ControlBar"),h=u["default"].getComponent("Button"),p=function(e){function t(e,i){o(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.hide(),this.initializeApi()}return r(t,e),s(t,[{key:"initializeApi",value:function(){var e=void 0,t=void 0,i=void 0;return u["default"].browser.IS_CHROME?chrome.cast&&chrome.cast.isAvailable?(this.show(),u["default"].log("Cast APIs are available"),t=this.options_.appId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=new chrome.cast.SessionRequest(t),e=new chrome.cast.ApiConfig(i,this.sessionJoinedListener.bind(this),this.receiverListener.bind(this)),chrome.cast.initialize(e,this.onInitSuccess.bind(this),this.castError.bind(this))):(u["default"].log("Cast APIs not available"),this.tryingReconnect<3&&(this.setTimeout(this.initializeApi,5e3),++this.tryingReconnect),void u["default"].log("Cast APIs not available. Max reconnect attempt")):void 0}},{key:"castError",value:function(e){return u["default"].log("Cast Error: "+JSON.stringify(e))}},{key:"onInitSuccess",value:function(){return this.apiInitialized=!0}},{key:"sessionJoinedListener",value:function(e){return console.log("Session joined")}},{key:"receiverListener",value:function(e){return"available"===e?this.show():void 0}},{key:"doLaunch",value:function(){return u["default"].log("Cast video: "+this.player_.currentSrc()),this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError.bind(this)):u["default"].log("Session not initialized")}},{key:"onSessionSuccess",value:function(e){var t=void 0,i=void 0,n=void 0,o=void 0,r=void 0,s=void 0,a=void 0;u["default"].log("Session initialized: "+e.sessionId),this.selectedTrack=null,this.apiSession=e,this.addClass("connected");var c=this.player_.currentSrc(),l=this.player_.currentType();if(o=new chrome.cast.media.MediaInfo(c,l),this.options_.metadata){o.metadata=new chrome.cast.media.GenericMediaMetadata,r=this.options_.metadata;for(i in r)a=r[i],o.metadata[i]=a;var d=this.player().poster();d&&(t=new chrome.cast.Image(d),o.metadata.images=[t])}if(this.plTracks=this.options_.tracks,this.plTracks){this.nbTrack=1,this.tracks=[],s=this.plTracks;for(i in s)a=s[i],this.track=new chrome.cast.media.Track(this.nbTrack,chrome.cast.media.TrackType.TEXT),this.track.trackContentId=a.src,this.track.trackContentType=a.type,this.track.subtype=chrome.cast.media.TextTrackType.CAPTIONS,this.track.name=a.label,this.track.language=a.language,"showing"===a.mode&&(this.selectedTrack=this.track),this.track.customData=null,this.tracks.push(this.track),++this.nbTrack;o.textTrackStyle=new chrome.cast.media.TextTrackStyle,o.tracks=this.tracks}return n=new chrome.cast.media.LoadRequest(o),n.autoplay=!0,n.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(n,this.onMediaDiscovered.bind(this),this.castError.bind(this)),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))}},{key:"onTrackChangeHandler",value:function(){var e=void 0,t=void 0,i=void 0,n=void 0;for(this.activeTrackIds=[],i=this.player_.textTracks(),e=0,t=i.length;t>e;e++)n=i[e],"showing"===n.mode&&this.activeTrackIds.push(n.id);return this.tracksInfoRequest=new chrome.cast.media.EditTracksInfoRequest(this.activeTrackIds),this.apiMedia?this.apiMedia.editTracksInfo(this.tracksInfoRequest,this.onTrackSuccess.bind(this),this.onTrackError.bind(this)):void 0}},{key:"onTrackSuccess",value:function(){return u["default"].log("track added")}},{key:"onTrackError",value:function(){return u["default"].log("track error")}},{key:"onMediaDiscovered",value:function(e){return this.apiMedia=e,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.selectedTrack&&(this.activeTrackIds=[this.selectedTrack.trackId],this.tracksInfoRequest=new chrome.cast.media.EditTracksInfoRequest(this.activeTrackIds),this.apiMedia.editTracksInfo(this.tracksInfoRequest,this.onTrackSuccess.bind(this),this.onTrackError.bind(this))),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.player_.loadTech_("Chromecast",{receiver:this.apiSession.receiver.friendlyName}),this.casting=!0,this.paused=this.player_.paused(),this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0)}},{key:"onSessionUpdate",value:function(e){return this.apiMedia?e?void 0:this.onStopAppSuccess():void 0}},{key:"onMediaStatusUpdate",value:function(e){if(this.apiMedia)switch(this.currentMediaTime=this.apiMedia.currentTime,this.apiMedia.playerState){case chrome.cast.media.PlayerState.IDLE:return this.currentMediaTime=0,this.trigger("timeupdate"),this.onStopAppSuccess();case chrome.cast.media.PlayerState.PAUSED:if(this.paused)return;return this.player_.pause(),this.paused=!0;case chrome.cast.media.PlayerState.PLAYING:if(!this.paused)return;return this.player_.play(),this.paused=!1}}},{key:"startProgressTimer",value:function(e){return this.timer&&(this.clearInterval(this.timer),this.timer=null),this.timer=this.setInterval(e.bind(this),this.timerStep)}},{key:"play",value:function(){return this.apiMedia&&this.paused?(this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.onError.bind(this)),this.paused=!1):void 0}},{key:"pause",value:function(){return this.apiMedia?this.paused?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.onError),this.paused=!0):void 0}},{key:"seekMedia",value:function(e){var t=void 0;return t=new chrome.cast.media.SeekRequest,t.currentTime=e,this.player_.controlBar.progressControl.seekBar.videoWasPlaying&&(t.resumeState=chrome.cast.media.ResumeState.PLAYBACK_START),this.apiMedia.seek(t,this.onSeekSuccess.bind(this,e),this.onError.bind(this))}},{key:"onSeekSuccess",value:function(e){return this.currentMediaTime=e}},{key:"setMediaVolume",value:function(e,t){var i=void 0,n=void 0;return this.apiMedia?(n=new chrome.cast.Volume,n.level=e,n.muted=t,this.currentVolume=n.level,this.muted=t,i=new chrome.cast.media.VolumeRequest,i.volume=n,this.apiMedia.setVolume(i,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.onError.bind(this)),this.player_.trigger("volumechange")):void 0}},{key:"incrementMediaTime",value:function(){return this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING?this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,this.clearInterval(this.timer)):void 0}},{key:"mediaCommandSuccessCallback",value:function(e,t){return u["default"].log(e)}},{key:"onError",value:function(){return u["default"].log("error")}},{key:"stopCasting",value:function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.onError)}},{key:"onStopAppSuccess",value:function(){return this.clearInterval(this.timer),this.casting=!1,this.removeClass("connected"),this.player_.src(this.player_.options_.sources),this.paused||this.player_.one("seeked",function(){return this.player_.play()}),this.player_.currentTime(this.currentMediaTime),this.player_.controls(!1),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.apiMedia=null,this.apiSession=null}},{key:"buildCSSClass",value:function(){return"vjs-chromecast-button "+a(Object.getPrototypeOf(t.prototype),"buildCSSClass",this).call(this)}},{key:"handleClick",value:function(){return a(Object.getPrototypeOf(t.prototype),"handleClick",this).call(this),this.casting?this.stopCasting():this.doLaunch()}}]),t}(h);p.prototype.tryingReconnect=0,p.prototype.controlText_="Chromecast",d.prototype.options_.children.splice(12,0,"chromeCastButton"),l.registerComponent("ChromeCastButton",p),i["default"]=p,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){(function(n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=function(e,t,i){for(var n=!0;n;){var o=e,r=t,s=i;n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,r);if(void 0!==a){if("value"in a)return a.value;var c=a.get;if(void 0===c)return;return c.call(s)}var u=Object.getPrototypeOf(o);if(null===u)return;e=u,t=r,i=s,n=!0,a=u=void 0}},u="undefined"!=typeof window?window.videojs:"undefined"!=typeof n?n.videojs:null,l=o(u),d=e("../../../node_modules/global/window"),h=o(d),p=l["default"].getComponent("Component"),f=l["default"].getComponent("Tech"),v=function(e){function t(e,i){r(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.featuresVolumeControl=!0,this.movingMediaElementInDOM=!1,this.featuresFullscreenResize=!1,this.featuresProgressEvents=!0,this.receiver=e.source.receiver,this.triggerReady()}return s(t,e),a(t,[{key:"createEl",value:function(){var e=void 0;return e=l["default"].createEl("div",{id:this.options_.techId,className:"videojs-tech videojs-tech-chromecast",innerHTML:'<div class="casting-image" style="background-image: url(\''+this.options_.poster+'\')"></div><div class="casting-overlay"><div class="casting-information"><div class="casting-icon">&#58880</div><div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div></div></div>"})}},{key:"startProgressTimer",value:function(){return this.player_.chromecastButton.apiInitialized}},{key:"src",value:function(e){return void 0===e?this.el_.src:void 0}},{key:"onProgress",value:function(e){this.trigger("progress")}},{key:"resetSrc_",value:function(e){this.el()&&(this.el().src="",this.el().setMediaKeys?this.el().setMediaKeys(null).then(e,e):e())}},{key:"dispose",value:function(){this.mediaPlayer_&&this.mediaPlayer_.reset(),this.resetSrc_(Function.prototype),c(Object.getPrototypeOf(t.prototype),"dispose",this).call(this,this)}}]),t}(f);v.prototype.options_={},v.isSupported=function(){return Html5.isSupported()&&!!h["default"].MediaSource},f.withSourceHandlers(v),v.nativeSourceHandler={},v.nativeSourceHandler.canPlayType=function(e){var t=/^application\/(?:dash\+xml|(x-|vnd\.apple\.)mpegurl)/i,i=/^video\/(mpd|mp4|webm|m3u8)/i;return t.test(e)?"probably":i.test(e)?"maybe":""},v.nativeSourceHandler.canHandleSource=function(e){return e.type?v.nativeSourceHandler.canPlayType(e.type):e.src?v.nativeSourceHandler.canPlayType(e.src):""},v.nativeSourceHandler.handleSource=function(e,t){t.src(e.src)},v.nativeSourceHandler.dispose=function(){},v.registerSourceHandler(v.nativeSourceHandler),l["default"].options.chromecast={},p.registerComponent("Chromecast",v),f.registerTech("Chromecast",v),i["default"]=v,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../node_modules/global/window":4}],3:[function(e,t,i){(function(n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(e,t,i){for(var n=!0;n;){var o=e,r=t,s=i;n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,r);if(void 0!==a){if("value"in a)return a.value;var c=a.get;if(void 0===c)return;return c.call(s)}var u=Object.getPrototypeOf(o);if(null===u)return;e=u,t=r,i=s,n=!0,a=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof n?n.videojs:null,u=o(c),l=e("./component/control-bar/chromecast-button"),d=(o(l),e("./tech/chromecast")),h=(o(d),u["default"].getComponent("Component")),p=function(e){function t(e,i){r(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i)}return s(t,e),t}(h);p.prototype.options_={},u["default"].options.children.chromecast={},u["default"].addLanguage("de",{"CASTING TO":"WIEDERGABE AUF"}),u["default"].addLanguage("it",{"CASTING TO":"PLAYBACK SU"}),h.registerComponent("Chromecast",p),i["default"]=p,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./component/control-bar/chromecast-button":1,"./tech/chromecast":2}],4:[function(e,t,i){(function(e){"undefined"!=typeof window?t.exports=window:"undefined"!=typeof e?t.exports=e:"undefined"!=typeof self?t.exports=self:t.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,i){(function(n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:"undefined"!=typeof n?n.videojs:null,s=o(r),a=e("./videojs-chromecast"),c=o(a),u=function(e){(0,c["default"])(this,e)};s["default"].plugin("chromecast",u),i["default"]=u,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./videojs-chromecast":3}]},{},[5])(5)});